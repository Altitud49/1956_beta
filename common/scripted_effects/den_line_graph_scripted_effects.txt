
den_calculate_triangular_graph = {
    set_temp_variable = {
        sum_odds = 0
    }
    set_temp_variable = {
        adjust_by = 100
    }
    add_to_temp_variable = { sum_odds = den_lower_influence }
    add_to_temp_variable = { sum_odds = den_middle_influence }
    add_to_temp_variable = { sum_odds = den_upper_influence }
    divide_temp_variable = {
        adjust_by = sum_odds
    }
    set_variable = {
        den_triangle_lower = den_lower_influence
    }
    set_variable = {
        den_triangle_middle = den_middle_influence
    }
    set_variable = {
        den_triangle_upper = den_upper_influence
    }
	multiply_variable = {
		den_triangle_lower = adjust_by
	}
	multiply_variable = {
		den_triangle_middle = adjust_by
	}
	multiply_variable = {
		den_triangle_upper = adjust_by
	}
	set_variable = {
		den_triangle_x = den_triangle_upper
	}
	divide_variable = {
		den_triangle_x = 2
	}
	add_to_variable = {
		den_triangle_x = den_triangle_lower
	}
	set_temp_variable = {
		den_triangle_y_calc = den_triangle_upper
	}
	multiply_variable = {
		den_triangle_x = 2.37
	}
	multiply_temp_variable = {
		den_triangle_y_calc = 2.05
	}

	add_to_variable = {
		den_triangle_x = 134
	}
	set_variable = {
		den_triangle_y = 413
	}
	subtract_from_variable = {
		den_triangle_y = den_triangle_y_calc
	}
	
}

den_calculate_eqilibirum_bar = {
	set_variable = {
		den_lower_equilibrium_y = 100
	}
	subtract_from_variable = {
		den_lower_equilibrium_y = den_lower_equilibrium
	}
	multiply_variable = {
		den_lower_equilibrium_y = 1.65
	}
	add_to_variable = {
		den_lower_equilibrium_y = 15
	}
	set_variable = {
		den_middle_equilibrium_y = 100
	}
	subtract_from_variable = {
		den_middle_equilibrium_y = den_middle_equilibrium
	}
	multiply_variable = {
		den_middle_equilibrium_y = 1.65
	}
	add_to_variable = {
		den_middle_equilibrium_y = 15
	}
	set_variable = {
		den_upper_equilibrium_y = 100
	}
	subtract_from_variable = {
		den_upper_equilibrium_y = den_upper_equilibrium
	}
	multiply_variable = {
		den_upper_equilibrium_y = 1.65
	}
	add_to_variable = {
		den_upper_equilibrium_y = 15
	}
}

den_add_point_to_line_graph = {
	# Adds a random point to the line graph

    #add_to_array = {
    #    array = den_upper_loyalties
    #    value = den_upper_loyalty
    #}
    #add_to_array = {
    #    array = den_middle_loyalties
    #    value = den_middle_loyalty
    #}
    add_to_array = {
        array = den_lower_loyalties
        value = den_lower_loyalty
    }
    add_to_array = {
        array = den_middle_loyalties
        value = den_middle_loyalty
    }
    add_to_array = {
        array = den_upper_loyalties
        value = den_upper_loyalty
    }
	# This count is displayed as an x-axis label, increment it

	# We keep track of the last y position so we can calculate the slope
	set_variable = { den_lower_last = den_lower_y_position }
	set_variable = { den_middle_last = den_middle_y_position }
	set_variable = { den_upper_last = den_upper_y_position }
	
	# Random new y position, 10-90
	set_variable = { den_lower_y_position = den_lower_loyalty }
	set_variable = { den_middle_y_position = den_middle_loyalty }
	set_variable = { den_upper_y_position = den_upper_loyalty }
	#multiply_variable = { SAMPLE_y_position = 80 }
	#add_to_variable = { SAMPLE_y_position = 10 }
	#round_variable = SAMPLE_y_position

	# Prune arrays so they hold at most 20 elements
	if = {
		limit = {
			check_variable = { den_lower_loyalties_length > 22 }
		}
		remove_from_array = { array = den_lower_diffs index = 0 }
		remove_from_array = { array = den_lower_slopes index = 0 }
		remove_from_array = { array = den_lower_numbers index = 0 }
	}
	if = {
		limit = {
			check_variable = { den_middle_loyalties_length > 22 }
		}
		remove_from_array = { array = den_middle_diffs index = 0 }
		remove_from_array = { array = den_middle_slopes index = 0 }
		remove_from_array = { array = den_middle_numbers index = 0 }
	}
	if = {
		limit = {
			check_variable = { den_upper_loyalties_length > 22 }
		}
		remove_from_array = { array = den_upper_diffs index = 0 }
		remove_from_array = { array = den_upper_slopes index = 0 }
		remove_from_array = { array = den_upper_numbers index = 0 }
	}

	# The y position offset is the inverse of the y position
	set_temp_variable = { lower_offset = den_lower_last }
	multiply_temp_variable = { lower_offset = -1 }
	add_to_array = { den_lower_diffs = lower_offset }
	
	set_temp_variable = { middle_offset = den_middle_last }
	multiply_temp_variable = { middle_offset = -1 }
	add_to_array = { den_middle_diffs = middle_offset }
	
	set_temp_variable = { upper_offset = den_upper_last }
	multiply_temp_variable = { upper_offset = -1 }
	add_to_array = { den_upper_diffs = upper_offset }

	# The 'slope' here is simply the difference between the current y value and the last one, divided by 2 plus 50
	# These last two changes are needed for the shader
	set_temp_variable = { lower_diff = den_lower_y_position }
	subtract_from_temp_variable = { lower_diff = den_lower_last }
	divide_temp_variable = { lower_diff = 2 }
	add_to_temp_variable = { lower_diff = 50 }
	add_to_array = { den_lower_slopes = lower_diff }
	
	set_temp_variable = {
		den_lower_loyalties_calc = den_lower_loyalties_length
	}
	divide_temp_variable = {
		den_lower_loyalties_calc = 12
	}
	subtract_from_temp_variable = {
		den_lower_loyalties_calc = 0.5
	}
	round_temp_variable = den_lower_loyalties_calc
	multiply_temp_variable = {
		den_lower_loyalties_calc = 12
	}
	if = {
		limit = {
			check_variable = {
				den_lower_loyalties_length > 12
			}
		}
		subtract_from_variable = {
			den_lower_loyalties_length = den_lower_loyalties_calc
		}
	}
	add_to_array = { den_lower_numbers = den_lower_loyalties_length }
	
	set_temp_variable = { middle_diff = den_middle_y_position }
	subtract_from_temp_variable = { middle_diff = den_middle_last }
	divide_temp_variable = { middle_diff = 2 }
	add_to_temp_variable = { middle_diff = 50 }
	add_to_array = { den_middle_slopes = middle_diff }

	add_to_array = { den_middle_numbers = den_middle_loyalties_length }
	
	set_temp_variable = { upper_diff = den_upper_y_position }
	subtract_from_temp_variable = { upper_diff = den_upper_last }
	divide_temp_variable = { upper_diff = 2 }
	add_to_temp_variable = { upper_diff = 50 }
	add_to_array = { den_upper_slopes = upper_diff }

	add_to_array = { den_upper_numbers = den_upper_loyalties_length }

	add_to_variable = { den_lower_loyalties_length = 1 }
	add_to_variable = { den_middle_loyalties_length = 1 }
	add_to_variable = { den_upper_loyalties_length = 1 }
}