
#
# calculations for factory output
# range -0.2 - 0.2
# increments 8
# increment 0.05
# loyalty = 35
#
# loyalty * increments / 100 = 2.8 #increment value between 0 and 8
# round_variable = 2.8 = 3 #third increment to be used
# 3 * increment - range / 2 = value = -0.05 #value of the third increment
#
den_calculate_lower = {
    
    set_variable = {
        den_lower_manpower = den_lower_loyalty
    }
    multiply_variable = {
        den_lower_manpower = 6
    }
    multiply_variable = {
        den_lower_manpower = 0.01
    }
    round_variable = den_lower_manpower
    multiply_variable = {
        den_lower_manpower = 0.05
    }
    subtract_from_variable = {
        den_lower_manpower = 0.15
    }
    

    if = {
        limit = {
            check_variable = {
                den_lower_influence > 35
            }
        }
        set_variable = {
            den_lower_output = den_lower_loyalty
        }
        multiply_variable = {
            den_lower_output = 8
        }
        multiply_variable = {
            den_lower_output = 0.01
        }
        round_variable = den_lower_output
        multiply_variable = {
            den_lower_output = 0.05
        }
        subtract_from_variable = {
            den_lower_output = 0.2
        }
    }
    else = {
        clear_variable = den_lower_output
    }

    if = {
        limit = {
            check_variable = {
                den_lower_influence > 64
            }
        }
        set_variable = {
            den_lower_pp = den_lower_loyalty
        }
        multiply_variable = {
            den_lower_pp = 20
        }
        multiply_variable = {
            den_lower_pp = 0.01
        }
        round_variable = den_lower_pp
        multiply_variable = {
            den_lower_pp = 0.01
        }
        subtract_from_variable = {
            den_lower_pp = 0.1
        }
    }
    else = {
        clear_variable = den_lower_pp
    }
}
den_calculate_middle = {
    
    set_variable = {
        den_middle_defence = den_middle_loyalty
    }
    multiply_variable = {
        den_middle_defence = 10
    }
    multiply_variable = {
        den_middle_defence = 0.01
    }
    round_variable = den_middle_defence
    multiply_variable = {
        den_middle_defence = 0.02
    }
    subtract_from_variable = {
        den_middle_defence = 0.1
    }
    
    if = {
        limit = {
            check_variable = {
                den_middle_influence > 34
            }
        }
        set_variable = {
            den_middle_consumer = den_middle_loyalty
        }
        multiply_variable = {
            den_middle_consumer = 14
        }
        multiply_variable = {
            den_middle_consumer = 0.01
        }
        round_variable = den_middle_consumer
        multiply_variable = {
            den_middle_consumer = 0.01
        }
        subtract_from_variable = {
            den_middle_consumer = 0.07
        }
        multiply_variable = {
            den_middle_consumer = -1
        }
    }
    else = {
        clear_variable = den_middle_consumer
    }
    if = {
        limit = {
            check_variable = {
                den_middle_influence > 64
            }
        }
        set_variable = {
            den_middle_pp = den_middle_loyalty
        }
        multiply_variable = {
            den_middle_pp = 20
        }
        multiply_variable = {
            den_middle_pp = 0.01
        }
        round_variable = den_middle_pp
        multiply_variable = {
            den_middle_pp = 0.01
        }
        subtract_from_variable = {
            den_middle_pp = 0.1
        }
    }
    else = {
        clear_variable = den_middle_pp
    }
}
den_calculate_upper = {    
    set_variable = {
        den_upper_planning = den_upper_loyalty
    }
    multiply_variable = {
        den_upper_planning = 10
    }
    multiply_variable = {
        den_upper_planning = 0.01
    }
    round_variable = den_upper_planning
    multiply_variable = {
        den_upper_planning = 0.05
    }
    subtract_from_variable = {
        den_upper_planning = 0.25
    }
    if = {
        limit = {
            check_variable = {
                den_upper_influence > 34
            }
        }
        set_variable = {
            den_upper_contruction = den_upper_loyalty
        }
        multiply_variable = {
            den_upper_contruction = 12
        }
        multiply_variable = {
            den_upper_contruction = 0.01
        }
        round_variable = den_upper_contruction
        multiply_variable = {
            den_upper_contruction = 0.025
        }
        subtract_from_variable = {
            den_upper_contruction = 0.15
        }
    }
    else = {
        clear_variable = den_upper_construction
    }

    if = {
        limit = {
            check_variable = {
                den_upper_influence > 64
            }
        }
        set_variable = {
            den_upper_pp = den_upper_loyalty
        }
        multiply_variable = {
            den_upper_pp = 20
        }
        multiply_variable = {
            den_upper_pp = 0.01
        }
        round_variable = den_upper_pp
        multiply_variable = {
            den_upper_pp = 0.01
        }
        subtract_from_variable = {
            den_upper_pp = 0.1
        }
    }
    else = {
        clear_variable = den_upper_pp
    }    
}
den_calculate_stratas = {
    if = {
        limit = {
            check_variable = {
                den_upper_influence > 100
            }
        }
        set_variable = {
            den_upper_influence = 100
        }
    }
    if = {
        limit = {
            check_variable = {
                den_upper_loyalty > 100
            }
        }
        set_variable = {
            den_upper_loyalty = 100
        }
    }
    if = {
        limit = {
            check_variable = {
                den_middle_influence > 100
            }
        }
        set_variable = {
            den_middle_influence = 100
        }
    }
    if = {
        limit = {
            check_variable = {
                den_middle_loyalty > 100
            }
        }
        set_variable = {
            den_middle_loyalty = 100
        }
    }
    if = {
        limit = {
            check_variable = {
                den_lower_influence > 100
            }
        }
        set_variable = {
            den_lower_influence = 100
        }
    }
    if = {
        limit = {
            check_variable = {
                den_lower_loyalty > 100
            }
        }
        set_variable = {
            den_lower_loyalty = 100
        }
    }
    den_calculate_lower = yes
    den_calculate_middle = yes
    den_calculate_upper = yes
}
den_strengthen_union = {
    custom_effect_tooltip = den_strengthen_union
}
den_strengthen_party = {
    custom_effect_tooltip = den_strengthen_party
}
den_election_socialdemocratic_popularity = {
    if = {
        limit = {
            has_country_flag = socialdemokratiet_dominating
        }
        add_popularity = {
            ideology = democratic
            popularity = 0.03
        }
    }
    else = {
        add_popularity = {
            ideology = neutrality
            popularity = 0.03
        }
    }
}
den_election_conservative_popularity = {
    if = {
        limit = {
            has_country_flag = socialdemokratiet_dominating
        }
        add_popularity = {
            ideology = neutrality
            popularity = 0.03
        }
    }
    else = {
        add_popularity = {
            ideology = democratic
            popularity = 0.03
        }
    }
}
den_popularities_to_variables = {   #Dont forget to clear variables afterwards
    set_variable = {
        dem_pop = party_popularity@democratic
    }
    multiply_variable = {  #I hate this
        dem_pop = 100
    }
    set_variable = {
        neu_pop = party_popularity@neutrality
    }
    multiply_variable = {
        neu_pop = 100
    }
    set_variable = {
        fas_pop = party_popularity@fascism
    }
    multiply_variable = {
        fas_pop = 100
    }
    set_variable = {
        com_pop = party_popularity@communism
    }
    multiply_variable = {
        com_pop = 100
    }
}
den_popularities_clear = {
    clear_variable = dem_pop
    clear_variable = neu_pop
    clear_variable = fas_pop
    clear_variable = com_pop
}
den_switch_parties = {
    den_popularities_to_variables = yes
    set_popularities = {
        democratic = var:neu_pop
        neutrality = var:dem_pop
        fascism = var:fas_pop
        communism = var:com_pop
    }
    den_popularities_clear = yes
}
den_monarchy_popularities = {
    den_popularities_to_variables = yes
    add_to_variable = {
        dem_pop = neu_pop
    }
    divide_variable = {
        dem_pop = 2
    }
    set_popularities = {
        democratic = var:dem_pop
        neutrality = var:dem_pop
        fascism = var:fas_pop
        communism = var:com_pop
    }
    add_popularity = {
        ideology = neutrality
        popularity = 0.075
    }
    den_popularities_clear = yes
}
den_free_denmark_init = {
    set_country_flag = den_elections_disabled
    load_focus_tree = {
        tree = free_denmark
        keep_completed = yes
    }
	activate_mission = den_ships_seized
    set_party_name = {
        ideology = communism
        name = "Borgerlige Partisaner"
    }
    set_party_name = {
        ideology = democratic
        name = "Danmarks Frihedsråd"
    }
    set_party_name = {
        ideology = fascism
        name = "German Collaborators"
    }
    set_party_name = {
        ideology = neutrality
        name = "Glücksburg Restorationists"
    }
}
den_collab_denmark_init = {
    set_country_flag = den_elections_disabled
    load_focus_tree = {
        tree = collab_denmark
        keep_completed = yes
    }
    set_party_name = {
        ideology = communism
        name = "Borgerlige Partisaner"
    }
    set_party_name = {
        ideology = democratic
        name = "Danmarks Frihedsråd"
    }
    set_party_name = {
        ideology = fascism
        name = "German Collaborators"
    }
    set_party_name = {
        ideology = neutrality
        name = "Glücksburg Restorationists"
    }
}